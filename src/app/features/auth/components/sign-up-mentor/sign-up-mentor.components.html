<div>
    <app-navbar></app-navbar>

    <div class="min-h-[calc(100vh-72px)] flex items-center justify-center relative">
        <div class="absolute inset-0"></div>

        <div
            class="w-full max-w-5xl bg-base-100 shadow-xl rounded-xl p-8 relative z-10 min-h-[600px] md:min-h-[650px] lg:min-h-[700px]">

            <h2 class="text-3xl font-semibold text-center mb-6">Register as mentor</h2>                 

            <ol class="flex items-center w-full text-sm text-gray-500 font-medium sm:text-base mb-3">

                <li class="flex md:w-full items-center" [ngClass]="currentStep >= 1 ? 'text-emerald-500' : 'text-gray-600'">

                    <div class="flex items-center whitespace-nowrap">
                        <span class="w-6 h-6 border border-gray-300 rounded-full flex justify-center items-center mr-3 lg:w-10 lg:h-10"
                            [ngClass]="{
                            'bg-emerald-500 text-white border-none': currentStep >= 1,
                            'bg-gray-100 text-gray-600': currentStep < 1
                            }">

                            @if(currentStep > 1) {
                            ✓
                            } @else {
                            1
                            }
                        </span>
                        Basic Info
                    </div>

                    <div class="flex-auto border mx-2"
                        [ngClass]="currentStep > 1 ? 'border-emerald-500' : 'border-gray-300'"></div>
                </li>

                <li class="flex md:w-full items-center" [ngClass]="currentStep >= 2 ? 'text-emerald-500' : 'text-gray-600'">

                    <div class="flex items-center whitespace-nowrap">
                        <span class="w-6 h-6 border border-gray-300 rounded-full flex justify-center items-center mr-3 lg:w-10 lg:h-10"
                            [ngClass]="{
                            'bg-emerald-500 text-white border-none': currentStep >= 2,
                            'bg-gray-100 text-gray-600': currentStep < 2
                            }">

                            @if(currentStep > 2) {
                            ✓
                            } @else {
                            2
                            }
                        </span>
                        Background
                    </div>

                    <div class="flex-auto border mx-2"
                        [ngClass]="currentStep > 2 ? 'border-emerald-500' : 'border-gray-300'"></div>
                </li>

                <li class="items-center" [ngClass]="currentStep === 3 ? 'text-emerald-500' : 'text-gray-600'">

                    <div class="flex items-center">
                        <span class="w-6 h-6 border border-gray-300 rounded-full flex justify-center items-center mr-3 lg:w-10 lg:h-10"
                            [ngClass]="{
                            'bg-emerald-500 text-white border-none': currentStep === 3,
                            'bg-gray-100 text-gray-600': currentStep < 3
                            }">
                            3
                        </span>
                        Profile
                    </div>
                </li>

            </ol>    

            <div class="h-4 mb-9">
                @if (errorMessage()) {
                <div role="alert" class="alert alert-error alert-soft">
                    <span>{{errorMessage()}}</span>
                </div>
                }
            </div>               

            <form [formGroup]="authForm" (ngSubmit)="onSubmit()">

                <div class="flex justify-center">
                    <!-- Step 1: Basic Info -->
                    @if(currentStep === 1) {
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl w-full">

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">First Name <span class="text-error">*</span></span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter first name" formControlName="first_name"
                                required />

                            <div class="h-3">
                                @if (first_name!.invalid && (first_name!.dirty || first_name!.touched || formSubmitted())) {
                                    @if (first_name!.hasError('required')) {
                                    <span class="text-error text-xs">First Name is required.</span>
                                    }
                                }
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Last Name <span class="text-error">*</span></span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter last name" formControlName="last_name"
                                required />

                            <div class="h-3">
                                @if (last_name!.invalid && (last_name!.dirty || last_name!.touched || formSubmitted()))
                                {
                                    @if (last_name!.hasError('required')) {
                                    <span class="text-error text-xs">Last Name is required.</span>
                                    }
                                }
                            </div>
                        </div>

                        @if(!uidSignInWithGoogle() && !emailSignInWithGoogle()) {
                            <div class="form-control">
                                <label class="label mb-1"><span class="label-text">Email <span class="text-error">*</span></span></label>
                                <input type="email" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter email" formControlName="email"
                                    required />

                                <div class="h-3">
                                    @if (email!.invalid && (email!.dirty || email!.touched || formSubmitted())) {
                                        @if (email!.hasError('required')) {
                                        <span class="text-error text-xs">Email is required.</span>
                                        }
                                        @if (email!.hasError('email')) {
                                        <span class="text-error text-xs">Email must be in valid format.</span>
                                        }
                                    }
                                </div>
                            </div>

                            <div class="form-control">
                                <label class="label mb-1"><span class="label-text">Password <span class="text-error">*</span></span></label>
                                <input type="password" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter password" formControlName="password"
                                    required />

                                <div class="h-3">
                                    @if (password!.invalid && (password!.dirty || password!.touched || formSubmitted())) {
                                        @if (password!.hasError('required')) {
                                        <span class="text-error text-xs">Password is required.</span>
                                        }
                                    }
                                </div>
                            </div>
                        }
                        
                        <div class="form-control">
                            <label class="label mb-1">
                                <span class="label-text">Country <span class="text-error">*</span></span>
                            </label>

                            <select class="select select-bordered w-full select-sm" formControlName="country" required>
                                <option value="" disabled selected>Select your country</option>
                                <option value="Philippines">Philippines</option>
                                <option value="United States">United States</option>
                                <option value="Canada">Canada</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Australia">Australia</option>
                                <option value="Singapore">Singapore</option>
                                <option value="Japan">Japan</option>
                                <option value="India">India</option>
                            </select>

                            <div class="h-3">
                                @if (country!.invalid && (country!.dirty || country!.touched || formSubmitted())) {
                                @if (country!.hasError('required')) {
                                <span class="text-error text-xs">Country is required.</span>
                                }
                                }
                            </div>
                        </div>            
                    </div>
                    }

                    <!-- Step 2: Bakground -->
                    @if(currentStep === 2) {
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl w-full">

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Current Job</span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter current job" formControlName="current_job" />

                            <!-- <div class="h-3">
                                    @if (current_job!.invalid && (current_job!.dirty || current_job!.touched || formSubmitted()))
                                    {
                                    @if (current_job!.hasError('required')) {
                                    <span class="text-error text-xs">current_job is required.</span>
                                    }
                                    }
                                </div> -->
                        </div>

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Company</span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter company" formControlName="company" />

                            <!-- <div class="h-3">
                                    @if (company!.invalid && (company!.dirty || company!.touched || formSubmitted()))
                                    {
                                    @if (company!.hasError('required')) {
                                    <span class="text-error text-xs">Last Name is required.</span>
                                    }
                                    } 
                                </div> -->
                        </div>

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Professional Experience
                                    (Years)</span></label>
                            <input type="number" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter years of experience" formControlName="professional_years_experience" />

                            <!-- <div class="h-3">
                                    @if (profe_years_experience!.invalid && (profe_years_experience!.dirty || profe_years_experience!.touched || formSubmitted()))
                                    {
                                    @if (profe_years_experience!.hasError('required')) {
                                    <span class="text-error text-xs">Professional Experience (Years) is required.</span>
                                    }
                                    }
                                </div> -->
                        </div>

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Expertise</span></label>                            
                            <div
                                class="flex flex-wrap items-center gap-2 w-full min-h-[2.1rem] border border-gray-300 rounded-sm px-2 py-1 focus-within:ring-2 focus-within:ring-black bg-white cursor-text"
                                (click)="inputEl1.focus()"
                            >
                                @for (experty of expertiseList(); track $index) {
                                    <div class="badge bg-emerald-500 text-white gap-1">
                                        {{ experty }}
                                        <button type="button" class="ml-1 text-white" (click)="removeExpertise(experty)">✕</button>
                                    </div>
                                }

                                <input
                                    #inputEl1                                  
                                    type="text"
                                    class="flex-1 min-w-[100px] border-none focus:ring-0 outline-none text-sm placeholder-gray-400"
                                    placeholder="Type a expertise and press Enter"
                                    (keydown.enter)="addExpertiseFromInput($event)"                                    
                                />
                            </div>                                                   

                            <!-- <div class="h-3">
                                    @if (expertise!.invalid && (expertise!.dirty || expertise!.touched || formSubmitted()))
                                    {
                                    @if (expertise!.hasError('required')) {
                                    <span class="text-error text-xs">Expertise is required.</span>
                                    }
                                    }
                                </div> -->
                        </div>

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Industries <span class="text-error">*</span></span></label>

                            <div
                                class="flex flex-wrap items-center gap-2 w-full min-h-[2.1rem] border border-gray-300 rounded-sm px-2 py-1 focus-within:ring-2 focus-within:ring-black bg-white cursor-text"
                                (click)="inputEl2.focus()"
                            >
                                @for (industry of industriesList(); track $index) {
                                <div class="badge bg-emerald-500 text-white gap-1">
                                    {{ industry }}
                                    <button type="button" class="ml-1 text-white" (click)="removeIndustries(industry)">✕</button>
                                </div>
                                }

                                <input
                                    #inputEl2                                    
                                    type="text"
                                    class="flex-1 min-w-[100px] border-none focus:ring-0 outline-none text-sm placeholder-gray-400"
                                    placeholder="Type a industry and press Enter"
                                    (keydown.enter)="addIndustriesFromInput($event)"
                                    (blur)="markIndustriesTouched()"
                                />
                            </div>                               

                            <div class="h-3">
                                @if (industries!.invalid && (industries!.dirty || industries!.touched || formSubmitted()))
                                {
                                    @if (industries!.hasError('required')) {
                                    <span class="text-error text-xs">Industries is required.</span>
                                    }
                                }
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Skills <span class="text-error">*</span></span></label>

                            <div
                                class="flex flex-wrap items-center gap-2 w-full min-h-[2.1rem] border border-gray-300 rounded-sm px-2 py-1 focus-within:ring-2 focus-within:ring-black bg-white cursor-text"
                                (click)="inputEl3.focus()"
                            >
                                @for (skill of skillsList(); track $index) {
                                <div class="badge bg-emerald-500 text-white gap-1">
                                    {{ skill }}
                                    <button type="button" class="ml-1 text-white" (click)="removeSkill(skill)">✕</button>
                                </div>
                                }

                                <input
                                    #inputEl3                                    
                                    type="text"
                                    class="flex-1 min-w-[100px] border-none focus:ring-0 outline-none text-sm placeholder-gray-400"
                                    placeholder="Type a skill and press Enter"
                                    (keydown.enter)="addSkillFromInput($event)"
                                    (blur)="markSkillsTouched()"
                                />
                            </div>                            

                            <div class="h-3">
                                @if (skills!.invalid && (skills!.dirty || skills!.touched || formSubmitted())) {
                                    @if (skills!.hasError('required')) {
                                        <span class="text-error text-xs">At least one skill is required.</span>
                                    }
                                }
                            </div>
                        </div>                        

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Education</span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter education" formControlName="education" />
                        </div>

                       <div class="form-control">
                            <label class="label mb-1"><span class="label-text">School</span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter school" formControlName="school" />
                        </div>                        


                    </div>
                    }

                    <!-- Step 3: Pofile -->
                    @if(currentStep === 3) {
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl w-full">

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">LinkedIn <span class="text-error">*</span></span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter LinkedIn link" formControlName="linkedIn"
                                required />

                            <div class="h-3">
                                @if (linkedIn!.invalid && (linkedIn!.dirty || linkedIn!.touched || formSubmitted()))
                                    {
                                    @if (linkedIn!.hasError('required')) {
                                    <span class="text-error text-xs">LinkedIn is required.</span>
                                    }
                                }
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label mb-1"><span class="label-text">Website</span></label>
                            <input type="text" class="input input-bordered w-full input-sm placeholder-gray-400" placeholder="Enter your website" formControlName="website"
                                required />

                            <!-- <div class="h-3">
                                </div> -->
                        </div>

                        <div class="form-control">
                            <label class="label mb-1">
                                <span class="label-text">Bio / Description <span class="text-error">*</span></span>
                            </label>

                            <textarea class="textarea textarea-bordered w-full textarea-sm placeholder-gray-400" placeholder="Short description about you ..." formControlName="bio" rows="6"
                                required></textarea>

                            <div class="h-3">
                                @if (bio!.invalid && (bio!.dirty || bio!.touched || formSubmitted())) {
                                    @if (bio!.hasError('required')) {
                                        <span class="text-error text-xs">Bio / Description is required.</span>
                                    }
                                    @if (bio!.hasError('maxlength')) {
                                        <span class="text-error text-xs">Bio must not exceed 600 characters.</span>
                                    }                                
                                }
                            </div>
                        </div>

                    </div>
                    }
                </div>

                <!-- Fixed buttons -->
                <div class="absolute bottom-0 left-0 right-0 p-6 flex justify-end space-x-3">
                    @if(currentStep > 1) {
                        <div>                            
                            <p-button label="Back" severity="secondary" (click)="prevStep()"/>                                  
                        </div>
                    }
                    @if(currentStep < 3) 
                    { 
                        <div>                            
                            <p-button label="Next" (click)="nextStep()"/>                                  
                        </div>
                    }
                    @if(currentStep === 3) {
                        <div class="relative">
                            <p-button
                                label="Submit"                                
                                type="submit" 
                                [loading]="isSubmissionInProgress()"
                                [disabled]="isSubmissionInProgress()"
                            />                                                 
                        </div>
                    }
                </div>

            </form>
        </div>
    </div>
</div>